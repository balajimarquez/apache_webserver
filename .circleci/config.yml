version: 2.1
jobs:
  nginx:          
    docker:
      - image: circleci/node:14  
    steps:
      - checkout
      - run: npm install
      - run:
         name: Install kubectl
         command: |
           curl -LO "https://storage.googleapis.com/kubernetes-release/release/$(curl -s https://storage.googleapis.com/kubernetes-release/release/stable.txt)/bin/linux/amd64/kubectl"
           chmod +x kubectl
           sudo mv kubectl /usr/local/bin/
      - run:
         name: Deploy to Kubernetes
         command: |
           kubectl apply -f nginx_deploy.yaml  --kubeconfig=$KUBE_CONFIG


workflows:
  nginx-and-apache:
    jobs:
      - nginx